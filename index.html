<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LockedIn - Back to Basics</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #0a0a0a;
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(120, 219, 226, 0.3) 0%, transparent 50%),
                linear-gradient(135deg, #1e1e2e 0%, #0f0f0f 100%);
            z-index: -1;
        }
        
        .header {
            text-align: center;
            padding: 60px 20px 40px;
            background: rgba(0,0,0,0.2);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .header h1 {
            font-size: 4em;
            font-weight: 700;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: none;
        }
        
        .header .tagline {
            font-size: 1.6em;
            font-weight: 400;
            color: #e0e0e0;
            margin-bottom: 8px;
        }
        
        .header .subtitle {
            font-size: 1.1em;
            color: #a0a0a0;
            font-weight: 300;
            letter-spacing: 0.5px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .progress-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .progress-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .progress-circle {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            margin: 0 auto 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2em;
            font-weight: 700;
            position: relative;
            background: rgba(0,0,0,0.3);
            border: 2px solid rgba(255,255,255,0.1);
        }
        
        .progress-ring {
            position: absolute;
            width: 140px;
            height: 140px;
            transform: rotate(-90deg);
        }
        
        .progress-ring circle {
            width: 140px;
            height: 140px;
            fill: transparent;
            stroke-width: 8;
            stroke-linecap: round;
        }
        
        .progress-ring .progress-bg {
            stroke: rgba(255,255,255,0.1);
        }
        
        .progress-ring .progress-fill {
            stroke: url(#progressGradient);
            stroke-dasharray: 440;
            stroke-dashoffset: 440;
            transition: stroke-dashoffset 0.8s ease;
        }
        
        .progress-text {
            position: relative;
            z-index: 2;
            background: linear-gradient(135deg, #00d2d3, #667eea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .progress-section h2 {
            font-size: 2.2em;
            font-weight: 600;
            margin-bottom: 12px;
            color: #f0f0f0;
        }
        
        .progress-section p {
            color: #a0a0a0;
            font-size: 1.1em;
            line-height: 1.6;
            max-width: 500px;
            margin: 0 auto 30px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .stat-item {
            text-align: center;
            padding: 24px 20px;
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
        }
        
        .stat-item:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.08);
            border-color: rgba(255,255,255,0.2);
        }
        
        .stat-number {
            font-size: 2.4em;
            font-weight: 700;
            background: linear-gradient(135deg, #00d2d3, #667eea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }
        
        .stat-label {
            color: #a0a0a0;
            font-size: 0.95em;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .basics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }
        
        .basic-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 32px 28px;
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            position: relative;
            overflow: hidden;
        }
        
        .basic-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.5), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .basic-card:hover {
            transform: translateY(-8px);
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255,255,255,0.2);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        .basic-card:hover::before {
            opacity: 1;
        }
        
        .basic-card.completed {
            background: rgba(0, 210, 211, 0.1);
            border-color: rgba(0, 210, 211, 0.3);
            box-shadow: 0 8px 32px rgba(0, 210, 211, 0.2);
        }
        
        .basic-card.completed::before {
            background: linear-gradient(90deg, #00d2d3, #667eea, #00d2d3);
            opacity: 1;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .card-icon {
            font-size: 3em;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
        }
        
        .check-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 1.8em;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .check-btn::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #00d2d3, #667eea);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .check-btn:hover {
            transform: scale(1.1);
            border-color: rgba(255,255,255,0.4);
        }
        
        .check-btn.completed {
            background: linear-gradient(135deg, #00d2d3, #667eea);
            border-color: #00d2d3;
            transform: scale(1.05);
        }
        
        .check-btn.completed::before {
            opacity: 1;
        }
        
        .card-title {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 12px;
            color: #f0f0f0;
        }
        
        .card-description {
            color: #a0a0a0;
            line-height: 1.6;
            margin-bottom: 20px;
            font-size: 1.05em;
        }
        
        .card-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 1em;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }
        
        .card-input::placeholder {
            color: #666;
        }
        
        .card-input:focus {
            outline: none;
            border-color: #00d2d3;
            background: rgba(255,255,255,0.08);
            box-shadow: 0 0 20px rgba(0, 210, 211, 0.3);
        }
        
        .journal-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
        }
        
        .journal-section::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(0, 210, 211, 0.3));
            z-index: -1;
            border-radius: 24px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .journal-section:hover::before {
            opacity: 1;
        }
        
        .journal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .journal-header h2 {
            font-size: 1.8em;
            font-weight: 600;
            color: #f0f0f0;
        }
        
        .journal-textarea {
            width: 100%;
            min-height: 180px;
            padding: 24px;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            background: rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 1.1em;
            line-height: 1.7;
            resize: vertical;
            margin-bottom: 20px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }
        
        .journal-textarea::placeholder {
            color: #666;
            line-height: 1.6;
        }
        
        .journal-textarea:focus {
            outline: none;
            border-color: #00d2d3;
            background: rgba(0,0,0,0.3);
            box-shadow: 0 0 30px rgba(0, 210, 211, 0.2);
        }
        
        .ai-response {
            background: rgba(0, 210, 211, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 28px;
            margin-top: 20px;
            border: 1px solid rgba(0, 210, 211, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .ai-response::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(180deg, #00d2d3, #667eea);
        }
        
        .ai-response h3 {
            color: #00d2d3;
            margin-bottom: 16px;
            font-size: 1.3em;
            font-weight: 600;
        }
        
        .ai-response-text {
            color: #e0e0e0;
            line-height: 1.7;
            font-size: 1.05em;
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
            text-transform: none;
            letter-spacing: 0.5px;
            font-family: 'Inter', sans-serif;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #00d2d3, #667eea);
            color: white;
            border: 1px solid transparent;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(0, 210, 211, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.05);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.3);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #00d2d3;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .insights-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
            display: none;
        }
        
        .insights-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .insights-header h2 {
            font-size: 2em;
            font-weight: 600;
            color: #f0f0f0;
        }
        
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
        }
        
        .insight-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .insight-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(102, 126, 234, 0.3);
        }
        
        .insight-icon {
            font-size: 3em;
            margin-bottom: 16px;
        }
        
        .insight-card h3 {
            font-size: 1.3em;
            font-weight: 600;
            color: #f0f0f0;
            margin-bottom: 12px;
        }
        
        .insight-card p {
            color: #a0a0a0;
            line-height: 1.6;
        }
        
        .mood-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 40px;
            text-align: center;
        }
        
        .mood-header {
            margin-bottom: 30px;
        }
        
        .mood-header h2 {
            font-size: 2em;
            font-weight: 600;
            color: #f0f0f0;
            margin-bottom: 8px;
        }
        
        .mood-date {
            color: #a0a0a0;
            font-size: 1.1em;
        }
        
        .mood-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        
        .mood-emoji {
            font-size: 3em;
            padding: 16px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
            border: 3px solid transparent;
            position: relative;
        }
        
        .mood-emoji:hover {
            transform: scale(1.2);
            background: rgba(255, 255, 255, 0.1);
        }
        
        .mood-emoji.selected {
            background: rgba(0, 210, 211, 0.2);
            border-color: #00d2d3;
            transform: scale(1.15);
        }
        
        .mood-emoji::after {
            content: attr(data-label);
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8em;
            color: #a0a0a0;
            white-space: nowrap;
        }
        
        .mood-chart-container {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 16px;
            padding: 24px;
            margin-top: 20px;
        }
        
        .custom-habits-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 40px;
        }
        
        .custom-habits-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .custom-habits-header h2 {
            font-size: 2em;
            font-weight: 600;
            color: #f0f0f0;
        }
        
        .custom-habit-form {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .custom-habit-input {
            flex: 1;
            min-width: 200px;
            padding: 14px 16px;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 1em;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }
        
        .custom-habit-input:focus {
            outline: none;
            border-color: #00d2d3;
            background: rgba(255,255,255,0.08);
            box-shadow: 0 0 20px rgba(0, 210, 211, 0.3);
        }
        
        .weekly-coach-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 40px;
        }
        
        .coach-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .coach-header h2 {
            font-size: 2.2em;
            font-weight: 600;
            color: #f0f0f0;
            margin-bottom: 12px;
        }
        
        .coach-conversation {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .coach-message {
            background: rgba(0, 210, 211, 0.1);
            border-left: 4px solid #00d2d3;
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 16px;
            color: #e0e0e0;
            line-height: 1.6;
        }
        
        .coach-prompt {
            color: #00d2d3;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .offline-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            background: rgba(255, 71, 87, 0.9);
            backdrop-filter: blur(20px);
            color: white;
            border-radius: 30px;
            font-weight: 600;
            font-size: 0.9em;
            display: none;
            z-index: 1000;
            border: 1px solid rgba(255, 71, 87, 0.3);
        }
        
        .offline-indicator.show {
            display: block;
            animation: slideIn 0.3s ease;
        }
        
        .demo-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .calendar-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 40px;
        }
        
        .calendar-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .calendar-header h2 {
            font-size: 2em;
            font-weight: 600;
            color: #f0f0f0;
            margin-bottom: 12px;
        }
        
        .calendar-header p {
            color: #a0a0a0;
            font-size: 1.1em;
            margin-bottom: 20px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 20px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            border: 1px solid rgba(255,255,255,0.1);
            position: relative;
            transition: all 0.3s ease;
        }
        
        .calendar-day.today {
            border-color: #00d2d3;
            background: rgba(0, 210, 211, 0.2);
        }
        
        .calendar-day.completed {
            background: linear-gradient(135deg, #00d2d3, #667eea);
            color: white;
            font-weight: bold;
        }
        
        .calendar-day.partial {
            background: linear-gradient(135deg, 
                #00d2d3 0%, 
                #00d2d3 var(--completion, 50%), 
                rgba(255,255,255,0.1) var(--completion, 50%)
            );
        }
        
        .ai-showcase-section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: 40px;
            margin-bottom: 40px;
            text-align: center;
        }
        
        .ai-showcase-header h2 {
            font-size: 2.2em;
            font-weight: 600;
            color: #f0f0f0;
            margin-bottom: 12px;
        }
        
        .ai-showcase-header p {
            color: #a0a0a0;
            font-size: 1.1em;
            max-width: 600px;
            margin: 0 auto 30px;
            line-height: 1.6;
        }
        
        .ai-features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .ai-feature-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .ai-feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #00d2d3, #667eea, #764ba2);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .ai-feature-card:hover {
            transform: translateY(-8px);
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(102, 126, 234, 0.3);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        .ai-feature-card:hover::before {
            opacity: 1;
        }
        
        .ai-feature-icon {
            font-size: 3em;
            margin-bottom: 16px;
        }
        
        .ai-feature-card h3 {
            font-size: 1.3em;
            font-weight: 600;
            color: #f0f0f0;
            margin-bottom: 12px;
        }
        
        .ai-feature-card p {
            color: #a0a0a0;
            line-height: 1.6;
            margin-bottom: 16px;
        }
        
        .ai-badge {
            background: linear-gradient(135deg, #00d2d3, #667eea);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .button-group {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 3em;
            }
            
            .basics-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 20px 15px;
            }
            
            .progress-section,
            .journal-section {
                padding: 24px;
            }
            
            .basic-card {
                padding: 24px 20px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .stats {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- SVG Definitions for Gradients -->
    <svg width="0" height="0">
        <defs>
            <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#00d2d3;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#667eea;stop-opacity:1" />
            </linearGradient>
        </defs>
    </svg>
    
    <div class="offline-indicator" id="offlineIndicator">
        üî¥ OFFLINE - Your data stays private and secure
    </div>
    
    <div class="header">
        <h1>üîí LockedIn</h1>
        <div class="tagline">Back to Basics</div>
        <div class="subtitle">When life gets overwhelming, lock in the fundamentals</div>
    </div>
    
    <div class="container">
        <!-- Demo Controls - Very Visible -->
        <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 20px; border-radius: 16px; text-align: center; margin-bottom: 30px;">
            <h3 style="color: white; margin-bottom: 15px;">üé¨ Demo Controls</h3>
            <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                <button class="btn btn-primary" id="demoModeBtn">üé¨ Demo Mode</button>
                <button class="btn btn-secondary" id="resetBtn">üîÑ Reset</button>
                <button class="btn" id="quickDemoBtn" style="background: #00d2d3; color: white;">‚ú® Quick Demo</button>
            </div>
        
        </div>
        
        <!-- AI Powered By Gemma 3n Banner -->
        <div style="background: linear-gradient(135deg, #00d2d3, #667eea); padding: 24px; border-radius: 16px; text-align: center; margin-bottom: 30px;">
            <h2 style="color: white; margin-bottom: 12px;">ü§ñ Powered by Gemma 3n AI</h2>
            <p style="color: rgba(255,255,255,0.9); margin-bottom: 16px;">Advanced on-device AI running completely private - no data leaves your device</p>
            <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                <button class="btn" id="generateInsights" style="background: rgba(255,255,255,0.2); color: white;">üß† AI Insights</button>
                <button class="btn" onclick="document.getElementById('getAISupport').click()" style="background: rgba(255,255,255,0.2); color: white;">üíô AI Support</button>
                <button class="btn" onclick="document.getElementById('startWeeklyCheckin').click()" style="background: rgba(255,255,255,0.2); color: white;">üéØ AI Coach</button>
            </div>
        </div>
        
        <div class="progress-section">
            <div class="progress-circle">
                <svg class="progress-ring">
                    <circle class="progress-bg" cx="70" cy="70" r="60"/>
                    <circle class="progress-fill" cx="70" cy="70" r="60" id="progressRing"/>
                </svg>
                <div class="progress-text" id="progressText">0/5</div>
            </div>
            <h2>Today's Progress</h2>
            <p>Focus on these 5 fundamentals. That's it. Everything else can wait.</p>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="streakCount">0</div>
                    <div class="stat-label">Day Streak</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="weekScore">0%</div>
                    <div class="stat-label">This Week</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="totalDays">0</div>
                    <div class="stat-label">Total Days</div>
                </div>
            </div>
        </div>
        
        <!-- Mood Tracking Section -->
        <div class="mood-section">
            <div class="mood-header">
                <h2>üåà How Are You Feeling?</h2>
                <div class="mood-date" id="moodDate">Today</div>
            </div>
            <div class="mood-selector">
                <div class="mood-emoji" data-mood="1" data-label="Terrible">üò¢</div>
                <div class="mood-emoji" data-mood="2" data-label="Bad">üòû</div>
                <div class="mood-emoji" data-mood="3" data-label="Meh">üòê</div>
                <div class="mood-emoji" data-mood="4" data-label="Good">üôÇ</div>
                <div class="mood-emoji" data-mood="5" data-label="Great">üòä</div>
                <div class="mood-emoji" data-mood="6" data-label="Amazing">üòÑ</div>
            </div>
            <div class="mood-chart-container">
                <canvas id="moodChart" width="600" height="200"></canvas>
            </div>
        </div>
        
        <!-- AI Insights Section -->
        <div class="insights-section" id="insightsSection">
            <div class="insights-header">
                <h2>üß† AI-Powered Insights</h2>
                <span style="color: #00d2d3;">Powered by Gemma 3n</span>
            </div>
            <div class="insights-grid">
                <div class="insight-card">
                    <div class="insight-icon">üìä</div>
                    <h3>Pattern Analysis</h3>
                    <p id="patternInsight">Analyzing your patterns...</p>
                </div>
                <div class="insight-card">
                    <div class="insight-icon">üí°</div>
                    <h3>Personalized Recommendation</h3>
                    <p id="recommendationInsight">Generating recommendations...</p>
                </div>
                <div class="insight-card">
                    <div class="insight-icon">üéØ</div>
                    <h3>Focus Area</h3>
                    <p id="focusInsight">Identifying your priority...</p>
                </div>
            </div>
        </div>
        
        <div class="basics-grid">
            <div class="basic-card" id="sleep-card">
                <div class="card-header">
                    <div class="card-icon">üò¥</div>
                    <button class="check-btn" id="sleep-check">‚úì</button>
                </div>
                <div class="card-title">8 Hours Sleep</div>
                <div class="card-description">Quality rest is non-negotiable. Your brain and body need it to heal and function.</div>
                <input type="time" class="card-input" id="sleep-time" placeholder="Bedtime">
            </div>
            
            <div class="basic-card" id="walk-card">
                <div class="card-header">
                    <div class="card-icon">üö∂‚Äç‚ôÇÔ∏è</div>
                    <button class="check-btn" id="walk-check">‚úì</button>
                </div>
                <div class="card-title">30 Min Walk</div>
                <div class="card-description">Move your body. Fresh air and movement clear the mind and reset your energy.</div>
                <input type="text" class="card-input" id="walk-notes" placeholder="Where did you walk today?">
            </div>
            
            <div class="basic-card" id="vitamins-card">
                <div class="card-header">
                    <div class="card-icon">üíä</div>
                    <button class="check-btn" id="vitamins-check">‚úì</button>
                </div>
                <div class="card-title">Take Vitamins</div>
                <div class="card-description">Fuel your body with essential nutrients. Small step, big impact on your health.</div>
                <input type="text" class="card-input" id="vitamins-list" placeholder="Which vitamins did you take?">
            </div>
            
            <div class="basic-card" id="todos-card">
                <div class="card-header">
                    <div class="card-icon">‚úÖ</div>
                    <button class="check-btn" id="todos-check">‚úì</button>
                </div>
                <div class="card-title">Top 3 Todos</div>
                <div class="card-description">Only 3 things. Keep it simple. Done is better than perfect.</div>
                <input type="text" class="card-input" id="todo1" placeholder="1. Most important task">
                <input type="text" class="card-input" id="todo2" placeholder="2. Second priority">
                <input type="text" class="card-input" id="todo3" placeholder="3. Third priority">
            </div>
        </div>
        
        <!-- Custom Habits Section -->
        <div class="custom-habits-section">
            <div style="background: linear-gradient(135deg, #fdcb6e, #e84393); padding: 20px; border-radius: 16px; text-align: center; margin-bottom: 20px;">
                <h2 style="color: white; margin-bottom: 12px;">‚ûï Add Your Personal Basics</h2>
                <p style="color: rgba(255,255,255,0.9); margin-bottom: 16px;">Beyond the core 5 - what other habits help you stay grounded?</p>
                <button class="btn" id="addCustomHabit" style="background: rgba(255,255,255,0.2); color: white; font-size: 1.1em; padding: 12px 24px;">‚ûï ADD CUSTOM HABIT</button>
            </div>
            
            <div class="custom-habit-form" id="customHabitForm" style="display: none;">
                <input type="text" class="custom-habit-input" id="habitName" placeholder="Habit name (e.g., Meditate 10 minutes)">
                <input type="text" class="custom-habit-input" id="habitEmoji" placeholder="Emoji (e.g., üßò‚Äç‚ôÄÔ∏è)">
                <button class="btn btn-primary" id="saveCustomHabit">Save Habit</button>
                <button class="btn btn-secondary" id="cancelCustomHabit">Cancel</button>
            </div>
            <div id="customHabitsGrid" class="basics-grid">
                <!-- Custom habits will be added here -->
            </div>
            <div class="ai-suggestions" id="aiSuggestions" style="margin-top: 20px;">
                <h3 style="color: #00d2d3; margin-bottom: 16px;">ü§ñ AI Habit Suggestions</h3>
                <p style="color: #a0a0a0; margin-bottom: 16px;">Based on your patterns, here are some habits that might help:</p>
                <div class="suggestion-buttons" id="suggestionButtons" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
                    <!-- AI suggestions will appear here -->
                </div>
            </div>
        </div>
        
        <!-- Weekly AI Coach Section -->
        <div id="weeklyCoachSection" class="weekly-coach-section" style="display: none;">
            <div class="coach-header">
                <h2>üéØ Weekly Check-in with Your AI Coach</h2>
                <p>Let's reflect on your week and set intentions for the next one</p>
            </div>
            <div id="coachConversation" class="coach-conversation">
                <div class="coach-message">
                    <div class="coach-prompt">Your AI Coach</div>
                    <div>Hi! I'm excited to check in with you this week. I've been observing your habits and journal entries, and I'm here to help you reflect and grow. How would you say this week went for you overall?</div>
                </div>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" id="startWeeklyCheckin">üéØ Start Weekly Check-in</button>
                <button class="btn btn-secondary" id="skipWeeklyCheckin">‚è≠ Skip This Week</button>
            </div>
        </div>

        <div class="journal-section">
            <div class="journal-header">
                <h2>üìù Daily Journal</h2>
                <button class="check-btn" id="journal-check">‚úì</button>
            </div>
            <textarea 
                class="journal-textarea" 
                id="journalText" 
                placeholder="How are you feeling today? Write whatever is on your mind. No judgment here. What's making things hard? What went well? What are you grateful for? Just let it out..."></textarea>
            <div class="button-group">
                <button class="btn btn-primary" id="getAISupport">ü§ñ Get AI Support</button>
                <button class="btn btn-secondary" id="saveJournal">üíæ Save Entry</button>
            </div>
            <div class="ai-response" id="aiResponse" style="display: none;">
                <h3>üíô AI Support</h3>
                <div class="ai-response-text" id="aiResponseText"></div>
            </div>
        </div>
    </div>

    <script>
        console.log("Starting LockedIn - Back to Basics...");
        
        class LockedIn {
            constructor() {
                console.log("Initializing LockedIn...");
                
                this.habits = ['sleep', 'walk', 'vitamins', 'todos', 'journal'];
                this.customHabits = [];
                this.completedToday = {};
                this.moodData = [];
                this.currentMood = null;
                this.weeklyInsights = null;
                this.stats = {
                    streak: 0,
                    totalDays: 0,
                    weekData: []
                };
                
                this.initializeElements();
                this.loadData();
                this.setupEventListeners();
                this.initializeMoodTracking();
                this.initializeCustomHabits();
                this.initializeWeeklyCoach();
                this.updateProgress();
                this.checkOnlineStatus();
                
                // Check for weekly coach trigger
                this.checkWeeklyCoachTrigger();
                
                // Initialize mood chart after a brief delay
                setTimeout(() => {
                    if (this.moodChart && this.moodChart.getContext) {
                        this.drawMoodChart();
                    }
                }, 100);
                
                console.log("LockedIn initialized successfully");
            }
            
            initializeElements() {
                this.progressRing = document.getElementById('progressRing');
                this.progressText = document.getElementById('progressText');
                this.streakCount = document.getElementById('streakCount');
                this.weekScore = document.getElementById('weekScore');
                this.totalDays = document.getElementById('totalDays');
                this.journalText = document.getElementById('journalText');
                this.aiResponse = document.getElementById('aiResponse');
                this.aiResponseText = document.getElementById('aiResponseText');
                this.offlineIndicator = document.getElementById('offlineIndicator');
                
                // New elements
                this.insightsSection = document.getElementById('insightsSection');
                this.moodChart = document.getElementById('moodChart');
                this.moodDate = document.getElementById('moodDate');
                this.customHabitsGrid = document.getElementById('customHabitsGrid');
                this.weeklyCoachSection = document.getElementById('weeklyCoachSection');
                this.coachConversation = document.getElementById('coachConversation');
                
                console.log('Elements initialized');
            }
            
            setupEventListeners() {
                // Habit check buttons
                this.habits.forEach(habit => {
                    const checkBtn = document.getElementById(`${habit}-check`);
                    if (checkBtn) {
                        checkBtn.addEventListener('click', () => this.toggleHabit(habit));
                    }
                });
                
                // AI support and save buttons
                const getAISupportBtn = document.getElementById('getAISupport');
                if (getAISupportBtn) {
                    getAISupportBtn.addEventListener('click', () => this.getAISupport());
                }
                
                const saveJournalBtn = document.getElementById('saveJournal');
                if (saveJournalBtn) {
                    saveJournalBtn.addEventListener('click', () => this.saveJournal());
                }
                
                // AI Insights button
                const generateInsightsBtn = document.getElementById('generateInsights');
                if (generateInsightsBtn) {
                    generateInsightsBtn.addEventListener('click', () => this.generateAIInsights());
                }
                
                // Custom habits event listeners
                const addHabitBtn = document.getElementById('addCustomHabit');
                const saveHabitBtn = document.getElementById('saveCustomHabit');
                const cancelHabitBtn = document.getElementById('cancelCustomHabit');
                
                if (addHabitBtn) {
                    addHabitBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.showCustomHabitForm();
                    });
                }
                
                if (saveHabitBtn) {
                    saveHabitBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.saveCustomHabit();
                    });
                }
                
                if (cancelHabitBtn) {
                    cancelHabitBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.hideCustomHabitForm();
                    });
                }
                
                // Weekly coach event listeners
                const startCheckinBtn = document.getElementById('startWeeklyCheckin');
                const skipCheckinBtn = document.getElementById('skipWeeklyCheckin');
                
                if (startCheckinBtn) {
                    startCheckinBtn.addEventListener('click', () => this.startWeeklyCheckin());
                }
                
                if (skipCheckinBtn) {
                    skipCheckinBtn.addEventListener('click', () => this.skipWeeklyCheckin());
                }
                
                // Mood tracking
                document.querySelectorAll('.mood-emoji').forEach(emoji => {
                    emoji.addEventListener('click', (e) => this.selectMood(e.target));
                });
                
                // Demo controls - Fixed method names
                const demoModeBtn = document.getElementById('demoModeBtn');
                const resetBtn = document.getElementById('resetBtn');
                const quickDemoBtn = document.getElementById('quickDemoBtn');
                
                if (demoModeBtn) {
                    demoModeBtn.addEventListener('click', () => this.enableDemoMode());
                }
                
                if (resetBtn) {
                    resetBtn.addEventListener('click', () => this.resetToFreshStart());
                }
                
                if (quickDemoBtn) {
                    quickDemoBtn.addEventListener('click', () => this.runQuickDemo());
                }
                
                // Auto-save inputs
                const inputs = document.querySelectorAll('.card-input, .journal-textarea');
                inputs.forEach(input => {
                    input.addEventListener('blur', () => this.saveData());
                });
                
                // Online/offline status
                window.addEventListener('online', () => this.checkOnlineStatus());
                window.addEventListener('offline', () => this.checkOnlineStatus());
                
                console.log('Event listeners setup complete');
            }
            
            // Add the missing methods
            enableDemoMode() {
                this.activateDemoMode();
            }
            
            resetToFreshStart() {
                this.resetApp();
            }
            
            // Rest of your existing methods...
            initializeMoodTracking() {
                const today = new Date();
                if (this.moodDate) {
                    this.moodDate.textContent = today.toLocaleDateString('en-US', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    });
                }
                
                setTimeout(() => {
                    this.drawMoodChart();
                }, 200);
            }
            
            selectMood(emojiElement) {
                document.querySelectorAll('.mood-emoji').forEach(e => e.classList.remove('selected'));
                
                emojiElement.classList.add('selected');
                const mood = parseInt(emojiElement.dataset.mood);
                this.currentMood = mood;
                
                const today = new Date().toISOString().split('T')[0];
                const existingMoodIndex = this.moodData.findIndex(m => m.date === today);
                
                if (existingMoodIndex >= 0) {
                    this.moodData[existingMoodIndex].mood = mood;
                } else {
                    this.moodData.push({ date: today, mood: mood });
                }
                
                this.moodData = this.moodData.slice(-30);
                
                this.drawMoodChart();
                this.saveData();
                this.checkMoodForCrisis(mood);
            }
            
            checkMoodForCrisis(mood) {
                if (mood <= 2) {
                    const recentLowMoods = this.moodData.slice(-3).filter(m => m.mood <= 2).length;
                    if (recentLowMoods >= 2) {
                        this.showCrisisSupport();
                    }
                }
            }
            
            showCrisisSupport() {
                const crisisMessage = `
                    <div style="background: rgba(255, 71, 87, 0.1); border: 1px solid #ff4757; border-radius: 12px; padding: 20px; margin: 20px 0;">
                        <h3 style="color: #ff4757; margin-bottom: 12px;">üÜò Crisis Support Available</h3>
                        <p style="margin-bottom: 12px;">I notice you've been struggling lately. Please know that you're not alone and help is available.</p>
                        <p style="margin-bottom: 12px;"><strong>Crisis Hotlines:</strong></p>
                        <p style="margin-bottom: 8px;">üá∫üá∏ National Suicide Prevention Lifeline: <strong>988</strong></p>
                        <p style="margin-bottom: 8px;">üí¨ Crisis Text Line: Text HOME to <strong>741741</strong></p>
                        <p style="margin-bottom: 12px;">üåç International: <strong>befrienders.org</strong></p>
                        <p>Please reach out to a trusted friend, family member, or professional. You matter.</p>
                    </div>
                `;
                
                this.insightsSection.style.display = 'block';
                this.insightsSection.innerHTML = crisisMessage + this.insightsSection.innerHTML;
            }
            
            drawMoodChart() {
                const canvas = this.moodChart;
                if (!canvas || !canvas.getContext) return;
                
                const ctx = canvas.getContext('2d');
                
                const container = canvas.parentElement;
                canvas.width = container.offsetWidth - 48;
                canvas.height = 200;
                
                const width = canvas.width;
                const height = canvas.height;
                
                ctx.clearRect(0, 0, width, height);
                
                if (this.moodData.length === 0) {
                    ctx.fillStyle = '#666';
                    ctx.font = '16px Inter';
                    ctx.textAlign = 'center';
                    ctx.fillText('Track your mood for a few days to see patterns', width/2, height/2);
                    return;
                }
                
                const padding = 40;
                const chartWidth = width - padding * 2;
                const chartHeight = height - padding * 2;
                
                ctx.strokeStyle = 'rgba(255,255,255,0.2)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(padding, height - padding);
                ctx.lineTo(width - padding, height - padding);
                ctx.moveTo(padding, padding);
                ctx.lineTo(padding, height - padding);
                ctx.stroke();
                
                if (this.moodData.length > 1) {
                    ctx.strokeStyle = '#00d2d3';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    
                    this.moodData.forEach((data, index) => {
                        const x = padding + (index / (this.moodData.length - 1)) * chartWidth;
                        const y = height - padding - ((data.mood - 1) / 5) * chartHeight;
                        
                        if (index === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    });
                    ctx.stroke();
                    
                    this.moodData.forEach((data, index) => {
                        const x = padding + (index / (this.moodData.length - 1)) * chartWidth;
                        const y = height - padding - ((data.mood - 1) / 5) * chartHeight;
                        
                        ctx.fillStyle = '#00d2d3';
                        ctx.beginPath();
                        ctx.arc(x, y, 6, 0, Math.PI * 2);
                        ctx.fill();
                    });
                }
                
                ctx.fillStyle = 'rgba(255,255,255,0.6)';
                ctx.font = '12px Inter';
                ctx.textAlign = 'right';
                const moodLabels = ['Terrible', 'Bad', 'Meh', 'Good', 'Great', 'Amazing'];
                moodLabels.forEach((label, index) => {
                    const y = height - padding - (index / 5) * chartHeight + 4;
                    ctx.fillText(label, padding - 8, y);
                });
            }
            
            initializeCustomHabits() {
                console.log('Initializing custom habits...');
                
                if (!this.customHabitsGrid) {
                    console.error('Custom habits grid not found in DOM');
                    return;
                }
                
                this.renderCustomHabits();
                this.generateHabitSuggestions();
                
                console.log('Custom habits initialized successfully');
            }
            
            showCustomHabitForm() {
                console.log('Showing custom habit form...');
                const form = document.getElementById('customHabitForm');
                
                if (form) {
                    form.style.display = 'flex';
                    
                    const nameInput = document.getElementById('habitName');
                    if (nameInput) {
                        setTimeout(() => {
                            nameInput.focus();
                        }, 100);
                    }
                }
            }
            
            hideCustomHabitForm() {
                console.log('Hiding custom habit form...');
                const form = document.getElementById('customHabitForm');
                if (form) {
                    form.style.display = 'none';
                    const nameInput = document.getElementById('habitName');
                    const emojiInput = document.getElementById('habitEmoji');
                    if (nameInput) nameInput.value = '';
                    if (emojiInput) emojiInput.value = '';
                }
            }
            
            saveCustomHabit() {
                console.log('Saving custom habit...');
                const nameInput = document.getElementById('habitName');
                const emojiInput = document.getElementById('habitEmoji');
                
                if (!nameInput || !emojiInput) {
                    console.error('Form inputs not found');
                    return;
                }
                
                const name = nameInput.value.trim();
                const emoji = emojiInput.value.trim() || '‚≠ê';
                
                if (!name) {
                    alert('Please enter a habit name');
                    return;
                }
                
                const habitId = 'custom_' + Date.now();
                const newHabit = {
                    id: habitId,
                    name: name,
                    emoji: emoji,
                    completed: false
                };
                
                console.log('Adding habit:', newHabit);
                this.customHabits.push(newHabit);
                
                this.hideCustomHabitForm();
                this.renderCustomHabits();
                this.saveData();
                
                const addBtn = document.getElementById('addCustomHabit');
                const originalText = addBtn.textContent;
                addBtn.textContent = '‚úÖ Added!';
                addBtn.style.background = 'linear-gradient(135deg, #00d2d3, #667eea)';
                setTimeout(() => {
                    addBtn.textContent = originalText;
                    addBtn.style.background = '';
                }, 2000);
            }
            
            renderCustomHabits() {
                console.log('Rendering custom habits:', this.customHabits);
                const grid = this.customHabitsGrid;
                if (!grid) {
                    console.error('Custom habits grid not found');
                    return;
                }
                
                grid.innerHTML = '';
                
                if (this.customHabits.length === 0) {
                    grid.innerHTML = `
                        <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #a0a0a0;">
                            <div style="font-size: 3em; margin-bottom: 16px;">üå±</div>
                            <div style="font-size: 1.2em; margin-bottom: 8px;">No custom habits yet</div>
                            <div>Click "Add Habit" to create your personal basics</div>
                        </div>
                    `;
                    return;
                }
                
                this.customHabits.forEach(habit => {
                    const habitCard = document.createElement('div');
                    habitCard.className = `basic-card ${habit.completed ? 'completed' : ''}`;
                    habitCard.id = `${habit.id}-card`;
                    
                    habitCard.innerHTML = `
                        <div class="card-header">
                            <div class="card-icon">${habit.emoji}</div>
                            <button class="check-btn ${habit.completed ? 'completed' : ''}" data-habit-id="${habit.id}">‚úì</button>
                        </div>
                        <div class="card-title">${habit.name}</div>
                        <div class="card-description">Your personal fundamental for today.</div>
                        <button class="btn btn-secondary" data-delete-habit="${habit.id}" style="margin-top: 10px; padding: 8px 12px; font-size: 0.9em;">üóëÔ∏è Remove</button>
                    `;
                    
                    grid.appendChild(habitCard);
                    
                    const checkBtn = habitCard.querySelector('.check-btn');
                    const deleteBtn = habitCard.querySelector('[data-delete-habit]');
                    
                    checkBtn.addEventListener('click', () => this.toggleCustomHabit(habit.id));
                    deleteBtn.addEventListener('click', () => this.deleteCustomHabit(habit.id));
                });
            }
            
            toggleCustomHabit(habitId) {
                console.log('Toggling custom habit:', habitId);
                const habit = this.customHabits.find(h => h.id === habitId);
                if (habit) {
                    habit.completed = !habit.completed;
                    const card = document.getElementById(`${habitId}-card`);
                    const checkBtn = card.querySelector('.check-btn');
                    
                    if (habit.completed) {
                        card.classList.add('completed');
                        checkBtn.classList.add('completed');
                        this.celebrateCompletion(card);
                    } else {
                        card.classList.remove('completed');
                        checkBtn.classList.remove('completed');
                    }
                    
                    this.updateProgress();
                    this.saveData();
                }
            }
            
            deleteCustomHabit(habitId) {
                if (confirm('Are you sure you want to remove this habit?')) {
                    console.log('Deleting custom habit:', habitId);
                    this.customHabits = this.customHabits.filter(h => h.id !== habitId);
                    this.renderCustomHabits();
                    this.updateProgress();
                    this.saveData();
                }
            }
            
            async generateHabitSuggestions() {
                console.log('Generating habit suggestions...');
                
                const suggestions = [
                    { name: 'Meditate 10 minutes', emoji: 'üßò‚Äç‚ôÄÔ∏è' },
                    { name: 'Drink 8 glasses of water', emoji: 'üíß' },
                    { name: 'Read for 20 minutes', emoji: 'üìö' },
                    { name: 'Practice gratitude', emoji: 'üôè' },
                    { name: 'Stretch or yoga', emoji: 'ü§∏‚Äç‚ôÄÔ∏è' },
                    { name: 'Call a friend', emoji: 'üìû' },
                    { name: 'Deep breathing exercise', emoji: 'ü´Å' },
                    { name: 'Write in a journal', emoji: '‚úçÔ∏è' }
                ];
                
                const buttonsContainer = document.getElementById('suggestionButtons');
                if (!buttonsContainer) {
                    console.error('Suggestion buttons container not found');
                    return;
                }
                
                buttonsContainer.innerHTML = '';
                
                const randomSuggestions = suggestions.sort(() => 0.5 - Math.random()).slice(0, 4);
                
                randomSuggestions.forEach(suggestion => {
                    const btn = document.createElement('button');
                    btn.className = 'btn btn-secondary';
                    btn.style.cssText = `
                        margin: 5px; 
                        padding: 8px 12px; 
                        font-size: 0.9em;
                        white-space: nowrap;
                    `;
                    btn.innerHTML = `${suggestion.emoji} ${suggestion.name}`;
                    btn.addEventListener('click', () => this.addSuggestedHabit(suggestion));
                    buttonsContainer.appendChild(btn);
                });
                
                console.log('Generated', randomSuggestions.length, 'habit suggestions');
            }
            
            addSuggestedHabit(suggestion) {
                console.log('Adding suggested habit:', suggestion);
                
                const habitId = 'custom_' + Date.now();
                const newHabit = {
                    id: habitId,
                    name: suggestion.name,
                    emoji: suggestion.emoji,
                    completed: false
                };
                
                this.customHabits.push(newHabit);
                this.renderCustomHabits();
                this.updateProgress();
                this.saveData();
                
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = '‚úÖ Added!';
                btn.disabled = true;
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }, 2000);
            }
            
            initializeWeeklyCoach() {
                // Will be triggered based on day of week
            }
            
            checkWeeklyCoachTrigger() {
                const today = new Date();
                const dayOfWeek = today.getDay();
                
                if (dayOfWeek === 0 || this.stats.totalDays >= 7) {
                    if (this.weeklyCoachSection) {
                        this.weeklyCoachSection.style.display = 'block';
                    }
                }
            }
            
            async startWeeklyCheckin() {
                const conversation = this.coachConversation;
                conversation.innerHTML = `
                    <div class="coach-message">
                        <div class="coach-prompt">Your AI Coach</div>
                        <div>Great! Let's dive into your week. I've been observing your progress...</div>
                    </div>
                `;
                
                const weeklyAnalysis = await this.generateWeeklyAnalysis();
                this.addCoachMessage(weeklyAnalysis);
                
                document.getElementById('startWeeklyCheckin').style.display = 'none';
            }
            
            skipWeeklyCheckin() {
                if (this.weeklyCoachSection) {
                    this.weeklyCoachSection.style.display = 'none';
                }
            }
            
            addCoachMessage(message) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'coach-message';
                messageDiv.innerHTML = `
                    <div class="coach-prompt">Your AI Coach</div>
                    <div>${message}</div>
                `;
                this.coachConversation.appendChild(messageDiv);
                this.coachConversation.scrollTop = this.coachConversation.scrollHeight;
            }
            
            async generateWeeklyAnalysis() {
                try {
                    const completed = Object.values(this.completedToday).filter(Boolean).length;
                    const avgMood = this.moodData.length > 0 ? 
                        this.moodData.reduce((sum, m) => sum + m.mood, 0) / this.moodData.length : 0;
                    
                    const prompt = `You are an AI life coach reviewing someone's week. Here's their data:
                    
- Habits completed today: ${completed}/5
- Average mood this week: ${avgMood.toFixed(1)}/6 
- Current streak: ${this.stats.streak} days
- Custom habits: ${this.customHabits.length}

Provide a warm, encouraging weekly analysis that:
- Celebrates their wins (even small ones)
- Identifies patterns you notice
- Gives 1-2 specific, actionable suggestions for next week
- Keeps an encouraging but realistic tone
- Under 150 words

Analysis:`;

                    const response = await fetch('http://localhost:11434/api/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            model: 'gemma3n:e4b',
                            prompt: prompt,
                            stream: false,
                            options: {
                                temperature: 0.6,
                                max_tokens: 200
                            }
                        })
                    });

                    if (!response.ok) throw new Error('API error');
                    
                    const data = await response.json();
                    return data.response;
                    
                } catch (error) {
                    return `Looking at your week, I can see you're making an effort with the basics - and that matters more than you might think. Every small step counts, especially when life feels overwhelming. For next week, I'd suggest focusing on just one habit at a time until it feels natural. You're building something important here. Keep going! üíô`;
                }
            }
            
            async generateAIInsights() {
                console.log('Generating AI insights...');
                this.insightsSection.style.display = 'block';
                
                document.getElementById('patternInsight').textContent = 'Analyzing your patterns...';
                document.getElementById('recommendationInsight').textContent = 'Generating recommendations...';
                document.getElementById('focusInsight').textContent = 'Identifying focus areas...';
                
                try {
                    const insights = await this.analyzeUserPatterns();
                    this.displayInsights(insights);
                } catch (error) {
                    console.error('Error generating insights:', error);
                    this.displayFallbackInsights();
                }
            }
            
            async analyzeUserPatterns() {
                const coreCompleted = Object.values(this.completedToday).filter(Boolean).length;
                const customCompleted = this.customHabits.filter(h => h.completed).length;
                const totalCompleted = coreCompleted + customCompleted;
                const avgMood = this.moodData.length > 0 ? 
                    this.moodData.reduce((sum, m) => sum + m.mood, 0) / this.moodData.length : 0;
                const journalContent = document.getElementById('journalText').value.trim();
                
                const prompt = `You are Gemma 3n, an advanced AI analyzing wellness patterns for personalized insights.

USER DATA ANALYSIS:
- Habits completed today: ${totalCompleted}/${this.habits.length + this.customHabits.length}
- Core habits: ${coreCompleted}/5 (${Object.entries(this.completedToday).filter(([k,v]) => v).map(([k,v]) => k).join(', ') || 'none'})
- Custom habits: ${customCompleted}/${this.customHabits.length} (${this.customHabits.filter(h => h.completed).map(h => h.name).join(', ') || 'none'})
- Average mood: ${avgMood.toFixed(1)}/6 (${this.moodData.length} data points)
- Current streak: ${this.stats.streak} days
- Total active days: ${this.stats.totalDays}
- Recent journal sentiment: "${journalContent.substring(0, 300)}"

ANALYSIS FRAMEWORK:
As an AI trained to understand human behavior patterns, provide THREE distinct insights:

1. PATTERN ANALYSIS: What specific behavioral pattern do you observe? Focus on correlations between habits, mood, and consistency.

2. PERSONALIZED RECOMMENDATION: Based on this user's specific data, what ONE actionable change would have the highest impact?

3. PRIORITY FOCUS: What should this user prioritize for the next 7 days to optimize their wellbeing?

Keep each insight under 60 words, actionable, and based on the actual data provided.

INSIGHTS:`;

                try {
                    const response = await fetch('http://localhost:11434/api/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            model: 'gemma3n:e4b',
                            prompt: prompt,
                            stream: false,
                            options: {
                                temperature: 0.5,
                                max_tokens: 300,
                                top_p: 0.85
                            }
                        })
                    });

                    if (!response.ok) throw new Error(`API error: ${response.status}`);
                    
                    const data = await response.json();
                    console.log('ü§ñ Gemma 3n AI Analysis Complete:', data.response);
                    return this.parseInsights(data.response);
                    
                } catch (error) {
                    console.error('Gemma 3n analysis failed:', error);
                    throw error;
                }
            }
            
            parseInsights(response) {
                const parts = response.split(/\d\.|PATTERN:|RECOMMENDATION:|FOCUS:/).filter(p => p.trim());
                return {
                    pattern: parts[0]?.trim() || "You're building consistency with the basics.",
                    recommendation: parts[1]?.trim() || "Focus on one habit at a time for better success.",
                    focus: parts[2]?.trim() || "Sleep quality seems to be your foundation."
                };
            }
            
            displayInsights(insights) {
                console.log('Displaying insights:', insights);
                
                const patternEl = document.getElementById('patternInsight');
                const recommendationEl = document.getElementById('recommendationInsight');
                const focusEl = document.getElementById('focusInsight');
                
                if (patternEl) patternEl.textContent = insights.pattern;
                if (recommendationEl) recommendationEl.textContent = insights.recommendation;
                if (focusEl) focusEl.textContent = insights.focus;
                
                [patternEl, recommendationEl, focusEl].forEach(el => {
                    if (el) {
                        el.style.opacity = '0.5';
                        setTimeout(() => {
                            el.style.transition = 'opacity 0.5s ease';
                            el.style.opacity = '1';
                        }, 100);
                    }
                });
            }
            
            displayFallbackInsights() {
                console.log('Displaying fallback insights...');
                
                const coreCompleted = Object.values(this.completedToday).filter(Boolean).length;
                const customCompleted = this.customHabits.filter(h => h.completed).length;
                const totalCompleted = coreCompleted + customCompleted;
                const totalPossible = this.habits.length + this.customHabits.length;
                
                let insights = {};
                
                if (totalCompleted === 0) {
                    insights = {
                        pattern: "You're just getting started! That's the hardest and most important step.",
                        recommendation: "Choose just one habit to focus on today - maybe sleep or a 30-minute walk.",
                        focus: "Building consistency matters more than perfection. Start small and be patient with yourself."
                    };
                } else if (totalCompleted >= 3) {
                    insights = {
                        pattern: "You're showing strong commitment to your basics - that's excellent progress!",
                        recommendation: "Try linking your habits together - like taking vitamins right after your morning routine.",
                        focus: "You're building real momentum. Consider adding one personal habit that brings you joy."
                    };
                } else {
                    insights = {
                        pattern: "You're making progress with the fundamentals - every step counts.",
                        recommendation: "Focus on consistency over perfection. Pick your easiest habit and nail it every day.",
                        focus: "Sleep quality affects everything else - prioritize getting those 8 hours first."
                    };
                }
                
                this.displayInsights(insights);
            }
            
            activateDemoMode() {
                console.log('üé¨ Activating Demo Mode with impressive data...');
                
                this.completedToday = {
                    sleep: true,
                    walk: true,
                    vitamins: true,
                    todos: true,
                    journal: false
                };
                
                this.customHabits = [
                    { id: 'demo_1', name: 'Meditate 10 minutes', emoji: 'üßò‚Äç‚ôÄÔ∏è', completed: true },
                    { id: 'demo_2', name: 'Drink 8 glasses water', emoji: 'üíß', completed: true },
                    { id: 'demo_3', name: 'Practice gratitude', emoji: 'üôè', completed: false }
                ];
                
                this.moodData = [];
                for (let i = 14; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    this.moodData.push({
                        date: date.toISOString().split('T')[0],
                        mood: Math.floor(Math.random() * 2) + 4
                    });
                }
                
                this.stats = {
                    streak: 15,
                    totalDays: 52,
                    weekData: []
                };
                
                const journalText = document.getElementById('journalText');
                if (journalText) {
                    journalText.value = "Started my day with meditation and a 30-minute walk. Feeling more centered lately. Work has been stressful but these daily basics are really helping me stay grounded. Grateful for this simple routine.";
                }
                
                this.updateProgress();
                this.renderCustomHabits();
                this.updateHabitCards();
                this.drawMoodChart();
                
                if (this.insightsSection) {
                    this.insightsSection.style.display = 'block';
                    this.generateAIInsights();
                }
                
                const btn = document.getElementById('demoModeBtn');
                if (btn) {
                    btn.textContent = '‚úÖ Demo Active';
                    btn.style.background = '#00d2d3';
                }
                
                console.log('üé¨ Demo mode activated! Stats:', this.stats);
                alert('üé¨ Demo Mode Activated!\n\n‚úÖ 15-day streak\n‚úÖ 52 total days\n‚úÖ Mood tracking data\n‚úÖ Custom habits\n‚úÖ Journal content\n');
            }
            
            resetApp() {
                if (confirm('Reset all data for fresh demo?')) {
                    console.log('üîÑ Resetting app to fresh state...');
                    
                    this.completedToday = {
                        sleep: false, walk: false, vitamins: false, todos: false, journal: false
                    };
                    this.customHabits = [];
                    this.moodData = [];
                    this.stats = { streak: 0, totalDays: 0, weekData: [] };
                    
                    const journalText = document.getElementById('journalText');
                    if (journalText) journalText.value = '';
                    
                    this.updateProgress();
                    this.renderCustomHabits();
                    this.updateHabitCards();
                    this.drawMoodChart();
                    
                    if (this.insightsSection) {
                        this.insightsSection.style.display = 'none';
                    }
                    
                    const btn = document.getElementById('demoModeBtn');
                    if (btn) {
                        btn.textContent = 'üé¨ Demo Mode';
                        btn.style.background = '';
                    }
                    
                    alert('üîÑ App Reset!\nFresh start for new demo.');
                }
            }
            
            async runQuickDemo() {
                const btn = document.getElementById('quickDemoBtn');
                if (btn) {
                    btn.textContent = '‚è≥ Running...';
                    btn.disabled = true;
                }
                
                try {
                    this.activateDemoMode();
                    await this.sleep(1000);
                    
                    const goodMood = document.querySelector('[data-mood="5"]');
                    if (goodMood) {
                        goodMood.click();
                        await this.sleep(1000);
                    }
                    
                    const insightsBtn = document.getElementById('generateInsights');
                    if (insightsBtn) {
                        insightsBtn.click();
                        await this.sleep(2000);
                    }
                    
                    document.getElementById('journalText').scrollIntoView({ behavior: 'smooth' });
                    await this.sleep(500);
                    
                    const aiSupportBtn = document.getElementById('getAISupport');
                    if (aiSupportBtn) {
                        aiSupportBtn.click();
                        await this.sleep(3000);
                    }
                    
                    if (btn) {
                        btn.textContent = '‚úÖ Demo Complete!';
                        btn.style.background = '#00d2d3';
                        setTimeout(() => {
                            btn.textContent = '‚ú® Quick Demo';
                            btn.style.background = '';
                            btn.disabled = false;
                        }, 2000);
                    }
                    
                } catch (error) {
                    console.error('Demo error:', error);
                    if (btn) {
                        btn.textContent = '‚ùå Error';
                        btn.disabled = false;
                    }
                }
            }
            
            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            
            updateHabitCards() {
                this.habits.forEach(habit => {
                    const card = document.getElementById(`${habit}-card`);
                    const checkBtn = document.getElementById(`${habit}-check`);
                    
                    if (card && checkBtn) {
                        if (this.completedToday[habit]) {
                            card.classList.add('completed');
                            checkBtn.classList.add('completed');
                        } else {
                            card.classList.remove('completed');
                            checkBtn.classList.remove('completed');
                        }
                    }
                });
            }
            
            checkOnlineStatus() {
                if (navigator.onLine) {
                    this.offlineIndicator.classList.remove('show');
                } else {
                    this.offlineIndicator.classList.add('show');
                }
            }
            
            toggleHabit(habit) {
                const card = document.getElementById(`${habit}-card`);
                const checkBtn = document.getElementById(`${habit}-check`);
                
                if (this.completedToday[habit]) {
                    this.completedToday[habit] = false;
                    card.classList.remove('completed');
                    checkBtn.classList.remove('completed');
                } else {
                    this.completedToday[habit] = true;
                    card.classList.add('completed');
                    checkBtn.classList.add('completed');
                    
                    this.celebrateCompletion(card);
                }
                
                this.updateProgress();
                this.saveData();
            }
            
            celebrateCompletion(card) {
                card.style.transform = 'scale(1.05)';
                card.style.background = 'rgba(0, 210, 211, 0.2)';
                
                setTimeout(() => {
                    card.style.transform = 'translateY(-8px)';
                    card.style.background = '';
                }, 200);
                
                this.createParticles(card);
            }
            
            createParticles(element) {
                const rect = element.getBoundingClientRect();
                const particles = 6;
                
                for (let i = 0; i < particles; i++) {
                    const particle = document.createElement('div');
                    particle.style.cssText = `
                        position: fixed;
                        width: 6px;
                        height: 6px;
                        background: #00d2d3;
                        border-radius: 50%;
                        pointer-events: none;
                        z-index: 1000;
                        left: ${rect.left + rect.width / 2}px;
                        top: ${rect.top + rect.height / 2}px;
                    `;
                    
                    document.body.appendChild(particle);
                    
                    const angle = (i / particles) * Math.PI * 2;
                    const velocity = 100;
                    const x = Math.cos(angle) * velocity;
                    const y = Math.sin(angle) * velocity;
                    
                    particle.animate([
                        { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                        { transform: `translate(${x}px, ${y}px) scale(0)`, opacity: 0 }
                    ], {
                        duration: 800,
                        easing: 'ease-out'
                    }).onfinish = () => particle.remove();
                }
            }
            
            updateProgress() {
                const coreCompleted = Object.values(this.completedToday).filter(Boolean).length;
                const customCompleted = this.customHabits.filter(h => h.completed).length;
                
                const totalCompleted = coreCompleted + customCompleted;
                const totalPossible = this.habits.length + this.customHabits.length;
                
                const percentage = totalPossible > 0 ? (totalCompleted / totalPossible) * 100 : 0;
                
                this.progressText.textContent = `${totalCompleted}/${totalPossible}`;
                const circumference = 2 * Math.PI * 60;
                const dashoffset = circumference - (percentage / 100) * circumference;
                this.progressRing.style.strokeDashoffset = dashoffset;
                
                this.updateStats();
            }
            
            updateStats() {
                const coreCompleted = Object.values(this.completedToday).filter(Boolean).length;
                const customCompleted = this.customHabits.filter(h => h.completed).length;
                
                const totalCompleted = coreCompleted + customCompleted;
                const totalPossible = this.habits.length + this.customHabits.length;
                const allComplete = totalPossible > 0 && totalCompleted === totalPossible;
                
                if (allComplete && this.stats.streak === 0) {
                    this.stats.streak = 1;
                    this.stats.totalDays = Math.max(this.stats.totalDays, 1);
                }
                
                this.animateNumber(this.streakCount, this.stats.streak);
                this.animateNumber(this.totalDays, this.stats.totalDays);
                
                const weekPercentage = totalPossible > 0 ? Math.round((totalCompleted / totalPossible) * 100) : 0;
                this.weekScore.textContent = `${weekPercentage}%`;
            }
            
            animateNumber(element, targetValue) {
                const currentValue = parseInt(element.textContent) || 0;
                const increment = targetValue > currentValue ? 1 : -1;
                const duration = 500;
                const steps = Math.abs(targetValue - currentValue);
                const stepDuration = duration / steps;
                
                if (steps === 0) return;
                
                let current = currentValue;
                const timer = setInterval(() => {
                    current += increment;
                    element.textContent = current;
                    
                    if (current === targetValue) {
                        clearInterval(timer);
                    }
                }, stepDuration);
            }
            
            async getAISupport() {
                const journalContent = document.getElementById('journalText').value.trim();
                
                if (!journalContent) {
                    this.showAIResponse("I'd love to support you, but I don't see any journal entry yet. Share what's on your mind first - whether it's struggles, victories, or just how you're feeling. I'm here to listen without judgment.");
                    return;
                }
                
                const btn = document.getElementById('getAISupport');
                const originalText = btn.innerHTML;
                btn.innerHTML = 'ü§ñ <span class="loading"></span>Gemma 3n is analyzing...';
                btn.disabled = true;
                btn.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
                
                try {
                    const response = await this.getGemmaSupport(journalContent);
                    this.showAIResponse(response, true);
                } catch (error) {
                    console.error('AI Support error:', error);
                    const fallbackResponse = this.generateFallbackResponse(journalContent);
                    this.showAIResponse(fallbackResponse, false);
                } finally {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    btn.style.background = '';
                }
            }
            
            generateFallbackResponse(journalContent) {
                const content = journalContent.toLowerCase();
                
                if (content.includes('overwhelm') || content.includes('stress') || content.includes('too much')) {
                    return "I can sense you're feeling overwhelmed right now. That's completely understandable - life can pile up quickly. The fact that you're here, focusing on these basics, shows incredible self-awareness. Remember: you don't have to do everything today. Just these 5 fundamentals. One step at a time. You're stronger than you know. üíô";
                }
                
                if (content.includes('sad') || content.includes('down') || content.includes('depressed')) {
                    return "I hear that you're going through a tough time. It takes courage to acknowledge these feelings and even more courage to keep taking care of yourself. The basics you're working on - sleep, movement, nutrition - these aren't just habits, they're acts of self-compassion. You're worth taking care of, especially when it's hardest to believe. üíô";
                }
                
                if (content.includes('anxious') || content.includes('worry') || content.includes('nervous')) {
                    return "Anxiety can make everything feel urgent and chaotic. That's exactly why these fundamentals are so powerful - they ground you in simple, manageable actions. Your nervous system needs the predictability of good sleep, gentle movement, and proper nutrition. You're creating stability in the storm. That's not small - that's everything. üíô";
                }
                
                if (content.includes('tired') || content.includes('exhausted') || content.includes('burnout')) {
                    return "Exhaustion is your body and mind asking for care. The beautiful thing about these basics is they're designed to restore rather than deplete you. Rest isn't earned - it's necessary. Movement doesn't have to be intense - gentle walks count. You're not lazy for being tired. You're human, and you deserve recovery. üíô";
                }
                
                if (content.includes('grateful') || content.includes('better') || content.includes('good')) {
                    return "I love seeing glimpses of positivity in your words. These moments of gratitude and progress, however small, are precious. They're proof that even in difficult times, there's light. Keep nurturing these feelings alongside the basics - they work together to build resilience and hope. You're doing beautifully. üíô";
                }
                
                return "Thank you for sharing what's on your heart. Writing things down is already a form of healing - you're processing and acknowledging your experience. Whatever you're going through, these fundamentals will support you. They're simple but powerful acts of self-care. You're taking the right steps, and I'm proud of you for showing up for yourself today. üíô";
            }
            
            async getGemmaSupport(journalContent) {
                const prompt = `You are Gemma 3n, a compassionate AI companion built into the "LockedIn" mental health app.

The user wrote: "${journalContent}"

As an advanced AI model running privately on their device, you understand that they are working on fundamental habits (sleep, walking, vitamins, todos, journaling) because they feel overwhelmed.

Your response should:
- Show deep empathy for their specific situation
- Connect their struggles to why these basics matter
- Provide practical, gentle encouragement
- Acknowledge that you're an AI but that you genuinely care about their wellbeing
- Keep under 120 words
- End with a supportive emoji

Be authentically caring while being clear about your nature as AI.

Response:`;

                try {
                    const response = await fetch('http://localhost:11434/api/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            model: 'gemma3n:e4b',
                            prompt: prompt,
                            stream: false,
                            options: {
                                temperature: 0.7,
                                max_tokens: 180
                            }
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`Gemma 3n API error: ${response.status}`);
                    }

                    const data = await response.json();
                    console.log('ü§ñ Gemma 3n Journal Support Response Generated');
                    return data.response || this.generateFallbackResponse(journalContent);
                    
                } catch (error) {
                    console.error('Gemma 3n journal support failed:', error);
                    throw error;
                }
            }
            
            showAIResponse(text, isAIGenerated = false) {
                const headerText = isAIGenerated ? 'ü§ñ Gemma 3n AI Support' : 'üíô Support (AI Offline)';
                const aiResponseHTML = `
                    <h3>${headerText}</h3>
                    <div class="ai-response-text">${text}</div>
                    ${isAIGenerated ? '<div style="margin-top: 12px; font-size: 0.85em; opacity: 0.7;">‚ú® Generated by Gemma 3n running locally on your device</div>' : ''}
                `;
                
                this.aiResponse.innerHTML = aiResponseHTML;
                this.aiResponse.style.display = 'block';
                
                setTimeout(() => {
                    this.aiResponse.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    this.aiResponse.style.animation = 'none';
                    this.aiResponse.offsetHeight;
                    this.aiResponse.style.animation = 'slideIn 0.5s ease';
                }, 100);
            }
            
            saveJournal() {
                const content = this.journalText.value.trim();
                if (content) {
                    this.completedToday.journal = true;
                    const journalCard = document.querySelector('.journal-section');
                    const journalCheck = document.getElementById('journal-check');
                    
                    journalCheck.classList.add('completed');
                    this.celebrateCompletion(journalCard);
                    
                    this.updateProgress();
                    this.saveData();
                    
                    const saveBtn = document.getElementById('saveJournal');
                    const originalText = saveBtn.innerHTML;
                    saveBtn.innerHTML = '‚úÖ Saved!';
                    saveBtn.style.background = 'linear-gradient(135deg, #00d2d3, #667eea)';
                    
                    setTimeout(() => {
                        saveBtn.innerHTML = originalText;
                        saveBtn.style.background = '';
                    }, 2000);
                }
            }
            
            saveData() {
                const data = {
                    completedToday: this.completedToday,
                    customHabits: this.customHabits,
                    moodData: this.moodData,
                    stats: this.stats,
                    inputs: this.getInputValues(),
                    lastSaved: new Date().toISOString()
                };
                
                try {
                    localStorage.setItem('lockedInData', JSON.stringify(data));
                    console.log('Data saved:', data);
                } catch (error) {
                    console.error('Error saving data:', error);
                }
            }
            
            loadData() {
                try {
                    const savedData = localStorage.getItem('lockedInData');
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        
                        // Check if it's a new day
                        const lastSaved = new Date(data.lastSaved);
                        const today = new Date();
                        const isNewDay = lastSaved.toDateString() !== today.toDateString();
                        
                        if (isNewDay) {
                            // Reset daily habits but keep stats and custom habits
                            this.completedToday = {
                                sleep: false,
                                walk: false,
                                vitamins: false,
                                todos: false,
                                journal: false
                            };
                            this.customHabits = data.customHabits || [];
                            this.customHabits.forEach(h => h.completed = false);
                            this.moodData = data.moodData || [];
                            this.stats = data.stats || { streak: 0, totalDays: 0, weekData: [] };
                        } else {
                            // Load everything as is
                            this.completedToday = data.completedToday || {};
                            this.customHabits = data.customHabits || [];
                            this.moodData = data.moodData || [];
                            this.stats = data.stats || { streak: 0, totalDays: 0, weekData: [] };
                            
                            // Restore input values
                            if (data.inputs) {
                                this.restoreInputValues(data.inputs);
                            }
                        }
                        
                        console.log('Data loaded from storage');
                    } else {
                        // Fresh start
                        this.completedToday = {
                            sleep: false,
                            walk: false,
                            vitamins: false,
                            todos: false,
                            journal: false
                        };
                        this.moodData = [];
                        this.customHabits = [];
                        this.stats = {
                            streak: 0,
                            totalDays: 0,
                            weekData: []
                        };
                        console.log('Starting fresh - no saved data found');
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                    // Start fresh on error
                    this.completedToday = {};
                    this.moodData = [];
                    this.customHabits = [];
                    this.stats = { streak: 0, totalDays: 0, weekData: [] };
                }
            }
            
            getInputValues() {
                return {
                    sleepTime: document.getElementById('sleep-time').value,
                    walkNotes: document.getElementById('walk-notes').value,
                    vitaminsList: document.getElementById('vitamins-list').value,
                    todo1: document.getElementById('todo1').value,
                    todo2: document.getElementById('todo2').value,
                    todo3: document.getElementById('todo3').value,
                    journalText: this.journalText.value
                };
            }
            
            restoreInputValues(inputs) {
                if (inputs.sleepTime) document.getElementById('sleep-time').value = inputs.sleepTime;
                if (inputs.walkNotes) document.getElementById('walk-notes').value = inputs.walkNotes;
                if (inputs.vitaminsList) document.getElementById('vitamins-list').value = inputs.vitaminsList;
                if (inputs.todo1) document.getElementById('todo1').value = inputs.todo1;
                if (inputs.todo2) document.getElementById('todo2').value = inputs.todo2;
                if (inputs.todo3) document.getElementById('todo3').value = inputs.todo3;
                if (inputs.journalText) this.journalText.value = inputs.journalText;
            }
        }
        
        // Initialize the app when page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM loaded, initializing LockedIn...");
            try {
                window.lockedIn = new LockedIn();
                console.log("LockedIn successfully initialized and attached to window");
            } catch (error) {
                console.error("Failed to initialize LockedIn:", error);
            }
        });
    </script>
</body>
</html>
